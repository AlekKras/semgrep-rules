rules:
  - id: file-overwritestream
    mode: taint
    pattern-sources:
      - patterns:
          - pattern-inside: |
              $FS.createReadStream(...). ... .on('...', function($SOURCE: $TYPE) {
                  ...
              })
          - pattern: $SOURCE
    pattern-sanitizers:
      - patterns:
          - pattern-inside: |
              $PATH = require('path')
              ...
          - pattern-either:
              - pattern: $PATH.resolve(...)
              - pattern: $PATH.normalize(...)
              - pattern: $PATH.basename(...)
      - patterns:
          - pattern-either:
              - pattern-inside: |
                  $FS = require('fs')
                  ...
              - pattern-inside: |
                  $FS = require('fs')
                  ...
          - pattern-either:
              - pattern: $FS.realpath(...)
              - pattern: $FS.realpathSync(...)
      - patterns:
          - pattern-inside: |
              require('sanitize-filename')
              ...
          - pattern: sanitize(...)
    pattern-sinks:
      - pattern: $FS.createWriteStream(...)
    message: Passing '$SOURCE' into createWriteStream() without any sanitization. Possible avenue for path traversal / arbitrary file overwrite.
    languages:
      - typescript
    severity: WARNING

