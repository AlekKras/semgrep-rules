rules:
  - id: express-tainted-sendfile
    message: |
      Data from the request object `$REQ` is going into sendFile(), which can lead to a path traversal vulnerability/local file inclusion. Be sure to sanitize the data and restrict files properly.
    languages: [javascript, typescript]
    severity: WARNING
    metadata:
      category: security
      cwe:
        - "CWE-73: External Control of File Name or Path"
        - "CWE-706: Use of Incorrectly-Resolved Name or Reference"
      owasp:
        - "A01:2021 - Broken Access Control"
        - "A05:2017 - Broken Access Control"
    mode: taint
    pattern-sources:
      - patterns:
          - pattern-either:
              - pattern-inside: function ... ($REQ, $RES) {...}
              - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
              # - pattern-inside: function ... ({ $PARAMS, $QUERY }, $RES, $NEXT) {...} # Commented out for now. Can uncomment later and add $PARAMS as a pattern and specify more specific sources from $REQ once destructuring is supported for TS
              - pattern-inside: $APP.get(..., function $FUNC($REQ, $RES) {...})
              - pattern-inside: $APP.post(..., function $FUNC($REQ, $RES) {...})
              - pattern-inside: $APP.put(..., function $FUNC($REQ, $RES) {...})
              - pattern-inside: $APP.head(..., function $FUNC($REQ, $RES) {...})
              - pattern-inside: $APP.delete(..., function $FUNC($REQ, $RES) {...})
              - pattern-inside: $APP.options(..., function $FUNC($REQ, $RES) {...})
          - pattern: $REQ
    pattern-sinks:
      - pattern: $RES.sendFile(...)
