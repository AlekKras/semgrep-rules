rules:
  - id: express-check-rate-limiting-bypass-taint
    mode: taint
    pattern-sources:
      - pattern: headers
      - pattern: header
    pattern-sinks:
      - patterns:
          - pattern-either:
              - pattern-inside: |
                  RateLimit( ... )
              - pattern-inside: |
                  rateLimit( ... )
          - pattern: |
              keyGenerator(...) { ... }
    message:
      Detected use of `keyGenerator()` within a RateLimit object, which may allow an attacker to
      bypass rate limiting by spoofing their identity with custom headers. It is recommended to 
      choose an attribute of the request that's best suited as an identifier for your application
      and use that instead.
    languages:
      - javascript
      - typescript
    metadata:
      category: security
      technology:
        - express
      owasp:
        - A06:2017 - Security Misconfiguration
        - A05:2021 - Security Misconfiguration
      references:
        - https://cloud.google.com/architecture/rate-limiting-strategies-techniques
        - https://owasp.org/www-community/controls/Blocking_Brute_Force_Attacks 
    severity: WARNING
